CREATE TABLE message (
  id TEXT NOT NULL PRIMARY KEY,
  conversation_id TEXT NOT NULL,
  sender_user_id TEXT NOT NULL,
  content TEXT NOT NULL
);

CREATE TABLE user (
  qualified_id TEXT NOT NULL PRIMARY KEY,
  name TEXT NOT NULL
);

-- Test literal custom key
selectAllUsers:
-- @CustomKey all_users
SELECT * FROM user;

-- Test template custom key with single parameter
selectConversationMessages:
-- @CustomKey conversation_:conversation_id
SELECT message.id, message.conversation_id, user.name AS sender_name, message.content
FROM message
JOIN user ON message.sender_user_id = user.qualified_id
WHERE message.conversation_id = :conversation_id;

-- Test multiple custom keys
selectUserInConversation:
-- @CustomKey conversation_:conversation_id
-- @CustomKey user_:user_id
SELECT * FROM message
WHERE conversation_id = :conversation_id AND sender_user_id = :user_id;

-- Test mutation with custom notify key
insertMessage:
-- @NotifyCustomKey conversation_:conversation_id
INSERT INTO message (id, content, conversation_id, sender_user_id)
VALUES (?, ?, ?, ?);

-- Test mutation with multiple notify keys
updateMessage:
-- @NotifyCustomKey conversation_:conversation_id
-- @NotifyCustomKey message_:id
UPDATE message
SET content = :content
WHERE id = :id;
